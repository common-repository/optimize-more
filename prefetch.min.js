"use strict";const prefetchConfig={delay:0,ignoreKeywords:["/wp-admin","/wp-login.php","/cart","/checkout","/my-account","add-to-cart","logout","/category","/product-category","#","?",".png",".jpeg",".jpg",".gif",".svg",".webp",".aviv"],prefetchMax:2,hoverDelay:30};class Prefetcher{constructor(){this.toPrefetch=new Set,this.alreadyPrefetched=new Set,this.linksObserver=null,this.hoverTimer=null,this.isSlowConnection=!1}init(){this.checkBrowserSupport(),this.checkConnection(),this.setupListeners(),this.startQueue(),this.startPrefetching()}checkBrowserSupport(){const t=document.createElement("link");this.isSupported=t.relList&&t.relList.supports&&t.relList.supports("prefetch")&&window.IntersectionObserver&&"isIntersecting"in IntersectionObserverEntry.prototype}checkConnection(){this.isSlowConnection=navigator.connection&&(navigator.connection.saveData||(navigator.connection.effectiveType||"").includes("2g"))}prefetch(t){return new Promise((e,o)=>{const n=document.createElement("link");n.rel="prefetch",n.href=t,n.onload=e,n.onerror=o,document.head.appendChild(n)})}prefetchWithTimeout(t){const e=setTimeout(()=>this.stopPrefetching(),2000);this.prefetch(t).catch(()=>this.stopPrefetching()).finally(()=>clearTimeout(e))}addUrlToQueue(t,e=!1){if(this.alreadyPrefetched.has(t)||this.toPrefetch.has(t))return;const n=window.location.origin;if(!t.startsWith(n))return;window.location.href!==t&&prefetchConfig.ignoreKeywords.every(e=>!t.includes(e))&&(e?(this.prefetchWithTimeout(t),this.alreadyPrefetched.add(t)):(this.toPrefetch.add(t),void 0))}setupListeners(){const t=e=>{const n=e.target.closest("a");n&&n.href&&!this.alreadyPrefetched.has(n.href)&&(this.hoverTimer=setTimeout(()=>{this.addUrlToQueue(n.href,!0)},prefetchConfig.hoverDelay))},e=t=>{const n=t.target.closest("a");n&&n.href&&!this.alreadyPrefetched.has(n.href)&&clearTimeout(this.hoverTimer)},n=t=>{const n=t.target.closest("a");n&&n.href&&!this.alreadyPrefetched.has(n.href)&&this.addUrlToQueue(n.href,!0)},o={capture:!0,passive:!0};document.addEventListener("mouseover",t,o),document.addEventListener("mouseout",e,o),document.addEventListener("touchstart",n,o),this.removeListeners=()=>{document.removeEventListener("mouseover",t,o),document.removeEventListener("mouseout",e,o),document.removeEventListener("touchstart",n,o)}}startQueue(){this.queueInterval=setInterval(()=>{Array.from(this.toPrefetch).slice(0,prefetchConfig.prefetchMax).forEach(t=>{this.prefetchWithTimeout(t),this.alreadyPrefetched.add(t),this.toPrefetch.delete(t)})},2000)}startPrefetching(){const t=document.querySelectorAll("a"),e=e=>{e.forEach(e=>{e.isIntersecting&&this.addUrlToQueue(e.target.href,!prefetchConfig.prefetchMax)})};this.linksObserver=new IntersectionObserver(e);const n=()=>{t.forEach(t=>this.linksObserver.observe(t))};window.requestIdleCallback(()=>{setTimeout(n,1e3*prefetchConfig.delay)})}stopPrefetching(){if(this.linksObserver){const t=document.querySelectorAll("a");t.forEach(t=>this.linksObserver.unobserve(t))}this.toPrefetch.clear(),this.removeListeners(),clearInterval(this.queueInterval)}}const prefetcher=new Prefetcher;prefetcher.init();